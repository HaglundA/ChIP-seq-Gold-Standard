#-----------------------------------------------------------------------------
#1. Genome generation and indexing
#-----------------------------------------------------------------------------


module load star/2.7.1a

Genomelocation=/rds/general/user/ah3918/ephemeral/alignments/genomes
mkdir $Genomelocation/GenomeIndexSTAR


vi STAR.qsub

#Vi text editor
#-----------------------------------------------------------------------------

#PBS -lwalltime=23:00:00
#PBS -lselect=1:ncpus=8:ompthreads=8:mem=80gb
STAR --runMode genomeGenerate \
--genomeDir $Genomelocation/GenomeIndexSTAR \
--genomeFastaFiles $Genomelocation/GRCh38.p13.genome.fa \
--sjdbGTFfile $Genomelocation/gencode.v32.chr_patch_hapl_scaff.basic.annotation.gtf \
--runThreadN 8

#-----------------------------------------------------------------------------
qsub STAR.qsub

#-----------------------------------------------------------------------------
#2. Alignment
#-----------------------------------------------------------------------------

GENOME=/rds/general/user/ah3918/ephemeral/alignments/genomes/GenomeIndexSTAR
ALIGNMENT=/rds/general/user/ah3918/ephemeral/alignments



#Change GSE directory in code. All GSE folders should have a text file with a list of
#fastq files in the directory


vi STAR.qsub
#-----------------------------------------------------------------------------
#PBS -lwalltime=24:00:00
#PBS -lselect=1:ncpus=8:ompthreads=8:mem=96gb
GENOME=/rds/general/user/ah3918/ephemeral/alignments/genomes/GenomeIndexSTAR
ALIGNMENT=/rds/general/user/ah3918/ephemeral/alignments
FILES=/rds/general/user/ah3918/ephemeral/chipseq/GSE69859
cd $FILES
ls *.fastq > fastqlist.txt
cd $ALIGNMENT
LIST=/rds/general/user/ah3918/ephemeral/chipseq/GSE69859/fastqlist.txt
name=$(cat $LIST)
module load star/2.7.1a
GENOME=/rds/general/user/ah3918/ephemeral/alignments/genomes/GenomeIndexSTAR

for i in $FILES
do


STAR --genomeDir $GENOME --readFilesIn $i --quantMode GeneCounts --runThreadN 8


done

#-----------------------------------------------------------------------------
